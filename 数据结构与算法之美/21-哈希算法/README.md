## 什么是哈希算法

将任意长度的二进制串映射为固定长度的二进制值串，这个映射的规则就是**哈希算法。**而通过原始数据映射之后得到的二进制值串就是**哈希值**

设计哈希算法的几点要求：

- 1、从哈希值不能反向推导出原始数据（所以哈希算法也叫单向哈希算法）
- 2、对输入数据非常敏感，哪怕原始数据只修改了一个 Bit，最后得到的哈希值也不大相同
- 3、散列冲突的概率要很小，对于不同的原始数据，哈希值相同的概率非常小
- 4、哈希算法的执行效率要尽量高效，针对较长的文本，也能快速地计算出哈希值。

## 哈希算法的应用

常见的 7 个有，安全加密、唯一标识、数据校验、散列函数、负载均衡、数据分片，分布式存储。

### 应用一：安全加密

最常用于加密的哈希算法是**MD5**（Message-Digest Algorithm， MD5 信息摘要算法）和**SHA**（Secure Hash Algorithm，安全散列算法）。除此之外，还有**DES**（Data Encryption Standard，数据加密标准）、**AES**（Advanced Encryption Standard，高级加密标准）。
哈希算法的四点要求，对用于加密的哈希算法来说，有两点格外重要。第一点是很难根据哈希值反向推导出原始数据，第二点是散列冲突的概率要很小。

### 应用二：唯一标识

对大数据做信息摘要

### 应用三：数据校验

BT 下载软件，将整个文件分割成多个文件块，对文件块分别求哈希值，并且保存在种子文件中。所有文件块都下载完成后，通过相同的哈希算法对下载好的文件块逐一求哈希值，然后跟种子文件中保存的哈希值比对。如果不同，说明这个文件块不完整或者被篡改了，需要再重新从其他宿主机器上下载这个文件块。

### 应用四：散列函数

实际上，散列函数也是哈希算法的一种应用。

不过，相对哈希算法的其他应用，散列函数对于散列算法冲突的要求要低很多。即便出现个别散列冲突，只要不是过于严重，我们都可以通过开放寻址法或者链表法解决。不仅如此，散列函数对于散列算法计算得到的值，是否能反向解密也并不关心。散列函数中用到的散列算法，更加关注散列后的值是否能平均分布，也就是，一组数据是否能均匀地散列在各个槽中。除此之外，散列函数执行的快慢，也会影响散列表的性能，所以，散列函数用的散列算法一般都比较简单，比较追求效率。

### 应用五：负载均衡

负载均衡算法有很多，比如轮询、随机、加权轮询等。
但是通常我们需要的是一个能实现会话粘滞（session sticky）的负载均衡算法，也就是，在同一个客户端上，在一次会话中的所有请求都路由到同一个服务器上。

我们可以通过哈希算法，对客户端 IP 地址或者会话 ID 计算哈希值，将取得的哈希值与服务器列表的大小进行取模运算，最终得到的值就是应该被路由到的服务器编号。

### 应用六：数据分片

两个例子

#### 1、如何统计“搜索关键词”出现的次数

如我们有 1T 的日志文件，这里面记录了用户的搜索关键词，我们想要快速统计出每个关键词被搜索的次数。这里有两个难点，第一个是搜索日志很大，没办法放到同一台机器的内存中。第二个难点是，如果只用一台机器来处理这么巨大的数据，处理时间会很长。

针对这两个难点，**我们可以先对数据进行分片，然后采用多台机器处理的方法，来提高处理速度。**具体的思路是这样的：为了提高处理的速度，我们用 n 台机器并行处理。我们从搜索记录的日志文件中，依次读出每个搜索关键词，并且通过哈希函数计算哈希值，然后再跟 n 取模，最终得到的值，就是应该被分配到的机器编号。

#### 2、如何快速判断图片是否在图库中

### 应用七：分布式存储

面对的都是海量的数据、海量的用户，我们为了提高数据的读取、写入能力，一般都采用分布式的方式来存储数据，比如分布式缓存。我们有海量的数据需要缓存，所以一个缓存机器肯定是不够的。于是，我们就需要将数据分布在多台机器上。我们可以借用前面数据分片的思想，即通过哈希算法对数据取哈希值，然后对机器个数取模，这个最终值就是应该存储的缓存机器编号。

但是如果需要增加机器，所有的数据都要重新计算哈希值，然后重新搬移到正确的机器上。这样就相当于，缓存中的数据一下子就都失效了。所有的数据请求都会穿透缓存，直接去请求数据库。这样就可能发生雪崩效应，压垮数据库。

所以，我们需要一种方法，使得在新加入一个机器后，并不需要做大量的数据搬移。这时候，一致性哈希算法就要登场了。
